<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Login und Register TEST</title>
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
      }

      * {
        box-sizing: border-box;
      }


    </style>
</head>

<body>
<button onclick="get_create_game_params()">Create Game</button>
<script>
 async function get_create_game_params() {
        const public = 1;
        var token = localStorage.getItem("KEY")
        console.log(token);
        console.log(public);
        create_game(token, public);
 }

 async function create_game(token, public) {
    try {
    console.log("get_create_game_prams started");
    //http://localhost:3004/login
    // http://raspisamuel.local:3004/login
      axios.post('http://localhost:3004/create_game',{
        KEY: token,  public: public
          }, {
       headers: {
 "Content-Type": "application/x-www-form-urlencoded"
}
})
  .then(function (response) {
    console.log(response);
    data = response["data"];
    console.log(data === "Invalid KEY");
    if((data === "Invalid KEY")){
      console.log(11);
      //document.getElementById("message").innerHTML = data;
      //ERROR could be displayed in Frontend
    }
    else{
      console.log(1);
      //location.href = "/Game"; //going to game
    }
  })
}
catch{};
}
</script>

<script>
    if(localStorage.getItem("KEY") === undefined) location.href = "/"
    async function loop(){
        await get_data();
        setInterval(await get_data(), 5000);
    }
    loop();
        async function get_data() {
            console.log();
            try {
                console.log(4);
                return new Promise ((resolveOuter) => {
                    console.log(2);
                    axios.get('http://raspisamuel.local:3004/your_live_games/'+localStorage.getItem("KEY"), {
                      headers: {
                       "Content-Type": "application/x-www-form-urlencoded"
                      }
                      })
                        .then(function (response) {
                            if(response["data"] === "Invalid KEY"){
                                localStorage.removeItem('KEY');
                                location.href = "/"
                            }
                            else{
                                console.log(response);
                                var data = response["data"];
                                for (let i = 0; i < data.length; i++) {
                                    show_data(data[i])
                                } 
                            }
                        })
                })
            }
            catch(error){  
                console.log(error);
            }
        }

    function show_data(data){
        var weiss = document.createElement("p");
        var schwarz = document.createElement("p");
        var aktueller_player = document.createElement("p");
        var abstand = document.createElement("br");
        var spielen = document.createElement("button");
        spielen.onclick =  function() {spiel(data["Games_ID"])};
        spielen.innerHTML = "Jetzt weiterspielen";
        weiss.innerHTML = "Weiss spielt: "+data["weiss"];
        schwarz.innerHTML = "Schwarz spielt: "+data["schwarz"];
        if(data["aktueller_player"] === 0 && data["weiss"] === data["m_user"]){
            aktueller_player.innerHTML = "Aktueller Spieler: "+"du";
        }
        else if(data["aktueller_player"] != 0 && data["weiss"] != data["m_user"]){
            aktueller_player.innerHTML = "Aktueller Spieler: "+"du";
        }
        else{
            aktueller_player.innerHTML = "Aktueller Spieler: "+"gegenspieler";
        }
        var main = document.getElementById("spiele");
        main.appendChild(weiss)
        main.appendChild(schwarz)
        main.appendChild(aktueller_player)
        main.appendChild(spielen);
        main.appendChild(abstand);
    }
      function spiel(zahl){
      //  localStorage.setItem('spiel', zahl);
        location.href = "/spielen";
      }


</script>
</body>
</html>
